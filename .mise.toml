[tools]
yq = "latest"
jq = "latest"
# note: rust-toolchain.toml is an 'idiomatic version file' for rust and mise does
#       pick it up automatically, but it is currently behind a experimental flag
rust = "{{ exec(command='yq .toolchain.channel rust-toolchain.toml') }}"
cargo-binstall = "latest"
"cargo:bacon" = "latest"
"cargo:cargo-progenitor" = "latest"

[env]
_.file = ['.env', '.env.local']

# Privy credentials for running examples
# You can set these values here, or in a .env.local file that mise will load.
# PRIVY_APP_ID = ""
# PRIVY_APP_SECRET = ""
# PRIVY_WALLET_ID = ""
# PRIVY_PUBLIC_KEY = ""

[tasks.pull-openapi]
description = "Pull the latest OpenAPI spec from the Privy API repo and apply our overlay"
run = [
  "curl https://api.privy.io/v1/openapi.json | jq -s -f 'scripts/openapi.jq' openapi.overlay.json - > openapi.json",
]

[tasks.generate-openapi]
description = "Generate the Rust code from the OpenAPI spec"
run = [
  "cargo progenitor --input openapi.json --output crates/privy-api --name privy-api --version 0.0.1 --interface builder --include-client=false"
]

[tasks.gen-p256-key]
description = "Generate P-256 key pair for Privy wallet owner"
run = [
  "openssl ecparam -genkey -name prime256v1 -noout -out private_key.pem",
  "openssl ec -in private_key.pem -pubout -out public_key.pem",
  "echo 'Generated P-256 key pair:'",
  "echo 'Private key: private_key.pem'",
  "echo 'Public key: public_key.pem'",
  "echo",
  "echo 'Public key contents:'",
  "cat public_key.pem"
]
